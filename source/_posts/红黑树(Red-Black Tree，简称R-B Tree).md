title:  红黑树(Red-Black Tree，简称R-B Tree)

date: 2017-06-17 00:00:02
tags: [ 数据结构 ]



---
# 红黑树(Red-Black Tree，简称R-B Tree)

红-黑树的就是这样的一棵平衡树，对一个要插入的数据项，插入例程要检查会不会破坏树的特征，如果破坏了，程序就会进行纠正，根据需要改变树的结构，从而保持树的平衡



- 【规则】有效的红黑树我们增加了如下的额外要求：

    - 1.节点是红色或黑色。
    - 2.根是黑色。
    - 3.所有叶子都是黑色（叶子是NIL节点）。
    - 4.每个红色节点必须有两个黑色的子节点。（从每个叶子到根的所有路径上不能有两个连续的红色节点。）
    - 5.从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。


作用：红黑树的节点是有颜色概念的，即非红即黑。`通过颜色的约束，红黑树维持着二叉搜索树的平衡性`



---
# `分析与理解`
```

结合： 【10,85,15,70,20 60,30,50】想象和理解
理想目标是绝对平衡树. 平衡控制主要由`规则5`来约束，假如在不设 规则1的颜色条件下，`绝对平衡树`会出现无法插入单结点只能整层插入。
为提供灵活性，设置红色为弹性元素可插入到新层中，但避免红色的单边蔓延，破坏了层数的平衡。（似2-3-4树 子树结点以元素存在）
通过`规则4`，来仅一步约束平衡。上限时为所有的黑结点提供满树的红色子结点。


小结：红色的出现是因为`绝对平衡树`不能接受单结点的插入，需要提供入口条件。AVL树的规则是允许平衡因子 BF 允许1层的差。
而红黑树的规则是，通过特殊色(红色)来提供入口，接受新元素) [彩蛋：AVL平衡树也不是绝对平衡BF为1的平衡]


为了避免层数的蔓延(相对平衡控制)，AVL树通过平衡因子BF差为1来控制，红黑树通过特殊色不能串层出现（`规则4`）。两者目的一样
红黑树，在排除特殊色的情况下，应该处于`绝对平衡树`状态。为方便理解 `绝对平衡树`状态下 层数计算，增加了(`规则3`)-辅助理解
`规则2`是确定了绝对平衡树的基准色(黑色)和特殊色(红色)，根颜色一定是绝对平衡树的基准色.
`规则1`是因为该算法只需要一个特殊色， 再 为了统一知识约定，将其定为红色和黑色。
```


|  绝对平衡树控制  |  插入新结点| 蔓延控制| 统计绝对平衡树层| 优缺点
----|------|----
绝对平衡树 |  根与到各结点的距离一致  | 不允许,会破坏绝对平衡<br> 只能按层插入| 【不需要】| |
AVL平衡树 |  (相对平衡)  | 弥补绝对平衡树的不能插入新结点的缺点 <br> 允许新结点加入新层 |  允许加入层差在1以内的新结点 |  总层数-溢出的新结点层(1)  |  更接近绝对平衡(差1层) <br> 平衡维持更频繁
红黑平衡树 |  (相对平衡)  | 弥补绝对平衡树的不能插入新结点的缺点 <br> 允许新结点以特殊色(红色)加入新层 |  设置特殊色(红色)不允许串层出现（规则4） <br> 类2-3-4树: <br> 4结点允许3个元素存在后再扩展子树 <br> (红结点类似3元素成员,允许平衡条件下特殊存在) |  黑色结点的层数(规则5) |  接近绝对平衡(最大差除2加1) <br> 平衡维持有特殊色缓冲




红黑平衡树-规则 | 红黑平衡树-作用或目的
----|------|----
5.从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点。|  `限定绝对平衡的关键规则`<br>弥补绝对平衡树的不能插入新结点的缺点<br>允许新结点以特殊色(红色)加入新层
4.每个红色节点必须有两个黑色的子节点。（从每个叶子到根的所有路径上不能有两个连续的红色节点。）| 设置`特殊色(红色)不允许串层`出现,避免蔓延控制<br>类2-3-4树:<br>4结点允许3个元素存在后再扩展子树<br>(`红结点类似3元素成员`,`允许平衡条件下特殊存在`)
3.所有叶子都是黑色（叶子是NIL节点）。|在排除特殊色的情况下，应该处于`绝对平衡树`状态。<br>规则3,为方便理解`绝对平衡树`状态下层数计算
2.根是黑色。| 规则2是确定了绝对平衡树的基准色(黑色)和特殊色(红色)，`根颜色黑色是绝对平衡树的基准色`
1.节点是红色或黑色。| 规则1是因为`该算法只需要一个基准色和一个特殊色`。`具体颜色再为了统一知识约定`，将其定为红色和黑色




---


# 规则冲突时,调整认识
红黑定义与切换，以及旋转都是随意的，只需要插入或删除结束后符合红黑树的规则(包含二叉排序树规则)
各场景该如何切换颜色与旋转，需转换为程序思维，依据场景进行变换（此变换不在红黑树的规则或要求限定以内）


`核心思路`：先变换颜色,满足[规则4].再检查[规则5]是否`提前越层`,如果是通过`旋转降层`恢复.


---
# 插入过程


见：★  `5. 数据结构 - 红黑树 - 简书` 
http://www.jianshu.com/p/f4639d0cc887


- 规则5,效果：
根据红黑树的性质（5），红黑树要求从根节点到叶子所有叶子节点上经过的黑色节点个数是相同的，因此如果插入的节点着色为黑色，那必然有可能导致某条路径上的黑色节点数量大于其他路径上的黑色节点数量，因此`默认插入的节点必须是红色`的，以此来维持红黑树的性质（5）



![](http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/85695560.jpg)

( 因为 G 为根节点，那么根据情况 1，将其涂为黑色，完事 )


- 规则4,效果：红红冲突，可简单讲父级改色。
但又违反了规则5[60子树黑点比10,110,140子树黑点多]， 将60改为红色，可维持规则5

![]( http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/23714147.jpg)


- 规则4,效果：维持了规则5情况下，规则4又出现冲突，但在更上层。 ![]( http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/69586036.jpg)


直观做法：将40设为黑色，可满足规则4。 120结点也设为黑色，可同时满足规则5。
（`此时状态，是不完全的平衡树，但满足红黑树规则`）
- 满足规则5的条件下，每个黑点可容纳上下层为红点，是不破坏规则5的。
![](http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/69567185.jpg)





- 示例：插入【10,85,15,70,20 60,30,50】
    - 首个为根，黑色：10

    - 85比10大，放右边，默认插入为红色。【红黑特性校验器-正常】     
    - 15比10大 比85小，放85左边，默认插入为 红 色。【红黑特性校验器-异常】     
    ![]( http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/41166636.jpg)


    -  【红黑特性校验器-异常】矫正
        -  对新插入节点的父节点进行一次右旋操作

        - 新插入节点的父节点着色为黑色，新插入节点的祖父节点着色为红色

        - 对新插入节点的祖父节点进行一次左旋操作

        ![]( http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/88789764.jpg)   ![](http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/10442624.jpg)


---
# gif 过程【10，85，15，70，20，60，30，50，65，80，90，40，5，55】 ![]( http://upload-images.jianshu.io/upload_images/1630488-0b740e32e6c690cf.gif?imageMogr2/auto-orient/strip )


---
**参考**


`教你初步了解红黑树 - 结构之法 算法之道 - CSDN博客`
http://blog.csdn.net/v_july_v/article/details/6105630
https://github.com/julycoding/The-Art-Of-Programming-By-July/blob/master/ebook/zh/03.01.md#教你透彻了解红黑树

- 五性质
★  `5. 数据结构 - 红黑树 - 简书` 
http://www.jianshu.com/p/f4639d0cc887


`JAVA学习-红黑树详解   - 简书 `
http://www.jianshu.com/p/4cd37000f4e3


`数据结构-红黑树 - 简书`
http://www.jianshu.com/p/5e567cc01b50


`红黑树(五)之 Java的实现 - 如果天空不死 - 博客园`
http://www.cnblogs.com/skywang12345/p/3624343.html


- 三性质(`特立的定义，会破坏知识的共同认知和沟通`)
★  `图解集合7：红黑树概念、红黑树的插入及旋转操作详细解读 - 五月的仓颉 - 博客园`
http://www.cnblogs.com/xrq730/p/6867924.html


`红黑树数据结构剖析 - Florian - 博客园`
http://www.cnblogs.com/fanzhidongyzby/p/3187912.html


- 四性质 (`特立的定义，会破坏知识的共同认知和沟通`)

`【数据结构和算法05】 红-黑树（看完包懂~） - 倪升武的博客 - 博客频道 - CSDN.NET`

http://blog.csdn.net/eson_15/article/details/51144079


---
#  红黑树 - 维基百科
`红黑树 - 维基百科，自由的百科全书`
https://zh.wikipedia.org/wiki/红黑树


`红黑树 - Wikiwand`
http://www.wikiwand.com/zh/%E7%BA%A2%E9%BB%91%E6%A0%91


`2-3-4树 - 维基百科，自由的百科全书` - 2-3-4 树是红黑树的一种等同
https://zh.mdzz.men/wiki/2-3-4%E6%A0%91